{% extends "scholarship/layout.html" %}
{% load static %}

{% block body %}
{% if user.is_authenticated %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-sm p-4">

                <h3 class="mb-4">Edit Scholarship</h3>

                <form id="edit-form" onsubmit="return false;">
                    <input type="hidden" id="scholarship-id" data-id="{{ scholarship.id }}">
                    <input type="hidden" id="original-date" data-date="{{ scholarship.date }}">

                    <div class="mb-3">
                        <label for="name-field" class="form-label">Scholarship Name</label>
                        <input
                            type="text"
                            id="name-field"
                            class="form-control"
                            placeholder="Name"
                            value="{{ scholarship.scholarship }}"
                            required
                        >
                    </div>

                    <div class="mb-3">
                        <label for="url-field" class="form-label">URL</label>
                        <input
                            type="url"
                            id="url-field"
                            class="form-control"
                            placeholder="https://example.com"
                            value="{{ scholarship.url }}"
                            required
                        >
                    </div>

                    <div class="mb-3">
                        <label for="amount-field" class="form-label">Amount</label>
                        <input
                            type="number"
                            id="amount-field"
                            class="form-control"
                            placeholder="Amount"
                            value="{{ scholarship.amount }}"
                        >
                    </div>

                    <div class="mb-3">
                        <label for="date-field" class="form-label">Deadline</label>
                        <input
                            type="date"
                            id="date-field"
                            class="form-control"
                            required
                        >
                    </div>

                    <div class="mb-3">
                        <label for="requirement-field" class="form-label">Requirements</label>
                        <textarea
                            id="requirement-field"
                            class="form-control"
                            placeholder="Requirements"
                            rows="3"
                        >{{ scholarship.requirements }}</textarea>
                    </div>

                    <button type="submit" id="edit-sub" class="btn btn-primary w-100">
                        Save Changes
                    </button>
                </form>

                <div class="mt-3 text-center">
                    <a href="{% url 'scholarship' scholarship.id %}" class="btn btn-link">
                        ‚Üê Back to Scholarship
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}


{% block script %}
<script>
document.addEventListener('DOMContentLoaded', () => {

    const csrftoken = getCookie('csrftoken')
    const id = document.querySelector('#scholarship-id').dataset.id
    const dateInput = document.querySelector('#date-field')

    // Pre-fill date field
    const originalDate = document.querySelector('#original-date').dataset.date
    dateInput.value = new Date(originalDate).toISOString().substring(0, 10)

    // Handle form submission
    document.querySelector('#edit-sub').onclick = () => {
        fetch(`/scholarships/edit/${id}`, {
            method: 'PUT',
            headers: {'X-CSRFToken': csrftoken},
            mode: 'same-origin',
            body: JSON.stringify({
                name: document.querySelector('#name-field').value,
                url: document.querySelector('#url-field').value,
                amount: document.querySelector('#amount-field').value,
                date: dateInput.value,
                requirements: document.querySelector('#requirement-field').value
            })
        })
        .then(response => response.json())
        .then(result => {
            console.log(result)
            window.location.href = `/scholarships/${id}`
        })
    }

    function getCookie(name) {
        let cookieValue = null
        if (document.cookie && document.cookie !== '') {
            document.cookie.split(';').forEach(cookie => {
                cookie = cookie.trim()
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.slice(name.length + 1))
                }
            })
        }
        return cookieValue
    }

})
</script>
{% endblock %}
