{% extends "scholarship/layout.html" %}
{% load static %}

{% block body %}

<h1 id = "id" data-id="{{scholarship.id}}">{{scholarship.scholarship}}</h1>

<a href="{{scholarship.url}}">{{scholarship.url}}</a>
<div>Deadline: {{scholarship.date}}</div>
<div>Amount: {{scholarship.amount}}</div>
<div>Requirements: {{scholarship.requirements}}</div>

{% if outdated == False %}
  <label>Status:</label>
    

    {% if scholarship.category == 'None' %}
        <select id="category">
            <option value="None">None</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
        </select>

    {% elif scholarship.category == 'In Progress' %}
        <select id="category">
            <option value="In Progress">In Progress</option>
            <option value="None">None</option>
            <option value="Completed">Completed</option>
        </select>
    {% elif scholarship.category == 'Completed' %}
        <select id="category">
            <option value="Completed">Completed</option>
            <option value="In Progress">In Progress</option>
            <option value="None">None</option>
        </select>
    {% endif %}
  <button class="submit-btn">Submit</button>
  {% endif %}
  <br>

    

    <h6>Document Links:</h6>
    <form action="{% url 'adddocumentlink' scholarship.id %}" method="post">
        {% csrf_token %}
        <input name="link" type="text" placeholder="Link">
        <input type="submit" value="Add Link">
    </form>
    <br>
    {% for link in scholarship.documents %}
    <a href="{{ link }}">{{ link }}</a> <button class="remove-link" data-link="{{link}}">Delete Link</button>
    <br>
    <br>
    {% endfor %}

  
  <button  id="edit-btn">Edit Scholarship</button><br/>
  <button class="remove-btn">Delete Scholarship</button><br/>
  
  <a href="{% url 'index' %}">Go Back to My Scholarships</a>


{% endblock %}

{% block script %}

<script>
    document.addEventListener('DOMContentLoaded', function () {

        const csrftoken = getCookie('csrftoken');
        document.addEventListener('click', event => {
        const element = event.target;
        if (element.className == "submit-btn"){
            let category = document.querySelector('#category').value
            let id = parseInt(document.querySelector('#id').dataset.id)
            fetch(`/scholarships/${id}`, {
                method: 'PUT',
                headers: {'X-CSRFToken': csrftoken},
                mode: 'same-origin',
                body: JSON.stringify({
                    category: category,
                })
            })
            .then(response => response.json())
            .then(result => {
                console.log(result);
                window.location.href = "{% url 'index' %}"
            });
        }
        else if (element.className == "remove-btn" && window.confirm("Are you sure you want to delete this scholarship?")){
            let id = parseInt(document.querySelector('#id').dataset.id)
            fetch(`/scholarships/remove/${id}`, {
                method: 'PUT',
                headers: {'X-CSRFToken': csrftoken},
                mode: 'same-origin',
                body: JSON.stringify({
                    delete: true,
                })
            })
            .then(result => {
                console.log(result);
                window.location.href = "{% url 'index' %}"
            });
        }
        else if (element.className == "remove-link" && window.confirm("Are you sure you want to delete this link?")){
            let id = parseInt(document.querySelector('#id').dataset.id)
            fetch(`/scholarships/${id}/adddocumentlink`, {
                method: 'PUT',
                headers: {'X-CSRFToken': csrftoken},
                mode: 'same-origin',
                body: JSON.stringify({
                    delete: true,
                    link: element.dataset.link,
                })
            })
            .then(result => {
                console.log(result);
                window.location.href = `/scholarships/${id}`
            });
        }
        
        })
        function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
        document.querySelector('#edit-btn').onclick = () => {
            let id = parseInt(document.querySelector('#id').dataset.id)
            window.location.href = `/scholarships/edit/${id}`
        }


    })



</script>
{% endblock %}